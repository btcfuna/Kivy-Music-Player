#:import MagicBehavior kivymd.uix.behaviors.MagicBehavior
<MagicButton@MagicBehavior+MDRoundFlatButton>
<Root@BoxLayout>
    orientation: 'vertical'

    MDToolbar:
        title: app.title

NavigationLayout:
    ScreenManager:
        id: screen_manager

        Screen:
            id: MainScreen
            name: 'MainScreen'
            song_name: song_name

            BoxLayout:
                orientation: 'vertical'

                MDToolbar:
                    title: app.title
                    elevation: 10
                    left_action_items: [['menu', lambda x: nav_drawer.toggle_nav_drawer()]]

                MDBottomAppBar:
                    MDToolbar:
                        text: "Location"
                        mode: 'end'
                        type: 'bottom'
                        icon: "folder"
                        text_color: app.theme_cls.primary_color
                        on_action_button: app.file_manager_open()
                Widget:
            
            MDTextField:
                id: song_name
                hint_text: "Search"
                helper_text: "Enter song name here"
                helper_text_mode: "on_focus"
                icon_right: "music-note"
                icon_right_color: app.theme_cls.primary_color
                pos_hint: {'center_x': 0.5, 'center_y': 0.7}
                size_hint:(0.5,0.08)
            
            MagicButton:
                text: 'SEARCH'
                id: search_btn
                pos_hint: {'center_x':0.5, 'y':0.5}
                text_color: app.theme_cls.primary_color
                on_press:
                    self.grow()
                on_release:
                    app.show_data()
                    
            MDSpinner:
                id: spinner
                padding: 10
                size_hint: None, None
                size: dp(46), dp(46)
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                active: False

        Screen:
            id: SongListScreen
            name: 'SongListScreen'
            BoxLayout:
                orientation: 'vertical'

                MDToolbar:
                    title: 'Results'
                    elevation: 10
                    left_action_items: [['chevron-left', lambda x: app.change_screen('MainScreen', 'right')]]

                ScrollView:
                    size_hint: (1, 2.5)
                    MDList:
                        id: container
                
                Widget:
        
        Screen:
            id: SongDetailsScreen
            name: 'SongDetailsScreen'
            BoxLayout:
                id: detailsbox
                orientation: 'vertical'

        Screen:
            id: DownloadsScreen
            name: 'DownloadsScreen'
            BoxLayout:
                orientation: 'vertical'
                MDToolbar:
                    title: 'Downloads'
                    elevation: 10
                    left_action_items: [['chevron-left', lambda x: app.change_screen('MainScreen', 'right')]]

                ScrollView:
                    size_hint: (1, 2.5)
                    MDList:
                        id: downloadlist
        Screen:
            id: PlayScreen
            name: 'PlayScreen'
            BoxLayout:
                orientation: 'vertical'
                MDToolbar:
                    title: 'Playing'
                    elevation: 10
                    left_action_items: [['chevron-left', lambda x: app.stop_song()]]
                Widget:
            
            MDIconButton:
                icon: "stop"
                pos_hint:{"center_x": .5, "center_y": .5}
                theme_text_color:"Custom"
                text_color:self.theme_cls.primary_color
                on_release: app.stop_song()

            MDIconButton:
                icon: "rewind-10"
                pos_hint:{"center_x": .4, "center_y": .5}
                on_release: app.rewind()
            MDIconButton:
                icon:"fast-forward-10"
                pos_hint:{"center_x": .6, "center_y": .5}
                on_release: app.forward()
            MDIconButton:
                icon:"volume-plus"
                pos_hint:{"center_x": .7, "center_y": .5}
                on_release: app.increase()
            MDIconButton:
                icon:"volume-minus"
                pos_hint:{"center_x": .3, "center_y": .5}
                on_release: app.decrease()

        Screen:
            id: AboutScreen
            name: 'AboutScreen'
            
            BoxLayout:
                orientation: 'vertical'
                size_hint: 1, 0.5
                pos_hint: {'center_x': 0.5, 'center_y': 0.75}

                MDToolbar:
                    elevation: 10
                    title: 'About'
                    left_action_items: [['chevron-left', lambda x: app.change_screen('MainScreen', 'right')]]

                Image:
                    source: './made.png'

                MDRoundFlatButton:
                    text: 'Contact us'
                    pos_hint: {'center_x':0.5}
                    text_color: app.theme_cls.primary_color
                    on_press:
                        app.contact_us()

        Screen:
            id: SettingsScreen
            name: 'SettingsScreen'
            
            BoxLayout:
                orientation: 'vertical'
                size_hint: 1, 0.5
                pos_hint: {'center_x': 0.5, 'center_y': 0.75}

                MDToolbar:
                    elevation: 10
                    title: 'Settings'
                    left_action_items: [['chevron-left', lambda x: app.change_screen('MainScreen', 'right')]]
                    
                FloatLayout:
                    MDLabel:
                        text: "     Dark Mode"
                        theme_text_color: 'Primary'
                        pos_hint: {'center_y': .5}
                    MDSwitch:
                        pos_hint: {'center_x': .8, 'center_y': .5}
                        on_active: app.change_theme()
                MDRoundFlatButton:
                    text: 'Save'
                    pos_hint: {'center_x':0.5, 'center_y':0.5}
                    text_color: app.theme_cls.primary_color
                    on_press:
                        app.save_settings()
                        app.change_screen('MainScreen', 'right')
                
                Widget:

    MDNavigationDrawer:
        id: nav_drawer
        BoxLayout:
            orientation: 'vertical'
            padding: "10dp"
            spacing: "8dp"
            
            AnchorLayout:
                anchor_x: "left"

                Image:
                    id: avatar
                    source: "./bh-circle_cropped.png"

            ScrollView:
                MDList:
                    OneLineIconListItem:
                        text: 'Home'
                        pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                        theme_text_color: "Custom"
                        text_color: app.theme_cls.primary_color
                        on_release:
                            nav_drawer.toggle_nav_drawer()
                            app.change_screen('MainScreen', 'right')
                        IconLeftWidget:
                            icon: 'home'
                            theme_text_color: "Custom"
                            text_color: app.theme_cls.primary_color
                            on_release:
                                nav_drawer.toggle_nav_drawer()
                                app.change_screen('MainScreen', 'right')
                        
                        
                    OneLineIconListItem:
                        text: 'Downloads'
                        on_release:
                            app.download_list()
                            nav_drawer.toggle_nav_drawer()
                            app.change_screen('DownloadsScreen', 'left')
                        IconLeftWidget:
                            icon: 'folder-download'
                    
                    OneLineIconListItem:
                        text: 'Settings'
                        on_release:
                            nav_drawer.toggle_nav_drawer()
                            app.change_screen('SettingsScreen', 'left')
                        IconLeftWidget:
                            icon: 'settings'
                            on_release:
                                nav_drawer.toggle_nav_drawer()
                                app.change_screen('SettingsScreen', 'left')

                    OneLineIconListItem:
                        text: 'About'
                        on_release:
                            nav_drawer.toggle_nav_drawer()
                            app.change_screen('AboutScreen', 'left')
                        IconLeftWidget:
                            icon: 'help-rhombus'
                            on_release:
                                nav_drawer.toggle_nav_drawer()
                                app.change_screen('AboutScreen', 'left')
